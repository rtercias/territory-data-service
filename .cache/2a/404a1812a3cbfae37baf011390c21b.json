{"id":"w7jF","dependencies":[{"name":"/Users/ryan.tercias/MyApps/territory-data-service/package.json","includedInParent":true,"mtime":1592367476738},{"name":"../server","loc":{"line":2,"column":21},"parent":"/Users/ryan.tercias/MyApps/territory-data-service/src/async/territories.js","resolved":"/Users/ryan.tercias/MyApps/territory-data-service/src/server.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var r=require(\"lodash\"),t=require(\"../server\");class e{async getTerritory(e){return(0,r.toArray)(await t.conn.query(`SELECT * FROM territories WHERE id=${e}`))[0]}async getTerritories(e){return(0,r.toArray)(await t.conn.query(`SELECT * FROM territories WHERE congregationid=${e}`))}async searchTerritories(e,i){return(0,r.toArray)(await t.conn.query(`SELECT * FROM territories WHERE congregationid=${e} name LIKE '%${i}%' OR description LIKE '%${i}%'`))}async getTerritoryStatus(e,i,n){return(0,r.toArray)(await t.conn.query(`\\n        SELECT ck.*, t.*, ck.id AS checkout_id, t.id AS territory_id, p.username, p.firstname, p.lastname, p.status AS publisher_status\\n        FROM territorycheckouts ck\\n        JOIN territories t ON ck.territoryid = t.id\\n        JOIN publishers p ON ck.publisherid = p.id\\n        WHERE t.congregationid=${e}\\n        ${i?` AND ck.territoryid=${i}`:\"\"}\\n        ${n?` AND p.username='${n}'`:\"\"}\\n      `))}async getTerritoriesByUser(e,i){return(0,r.toArray)(await t.conn.query(`\\n        SELECT ck.*, t.*\\n        FROM territorycheckouts_pivot ck\\n        JOIN territories t ON ck.territory_id = t.id\\n        WHERE ck.congregationid=${e}\\n        AND ck.username='${i}'\\n        AND ck.in IS NULL\\n      `))}async getMostRecentCheckin(r,e){return await t.conn.query(`\\n        SELECT ck.* FROM territorycheckouts ck\\n        JOIN publishers p ON ck.publisherid = p.id\\n        WHERE ck.territoryid=${r} AND p.username='${e}'\\n        AND ck.status = 'IN'\\n        ORDER BY ck.timestamp DESC\\n        LIMIT 1\\n      `)}async getTerritoriesByCity(e,i,n){const o=i?` city LIKE '%${i}%'`:\"\",c=n?` AND id=${n}`:\"\";return(0,r.toArray)(await t.conn.query(`SELECT * FROM territories_by_city WHERE congregationid=${e}${o}${c}`))}async getTerritoriesByGroupCode(e,i){return(0,r.toArray)(await t.conn.query(`SELECT * FROM territories_by_city WHERE congregationid=${e} AND group_code='${i}' ORDER BY city, name`))}async saveTerritoryActivity(r,e,i,n){n?await t.conn.query(`INSERT INTO territorycheckouts (territoryid, publisherid, status, create_user) VALUES (${e}, ${i}, '${r}', '${n}')`):await t.conn.query(`INSERT INTO territorycheckouts (territoryid, publisherid, status) VALUES (${e}, ${i}, '${r}')`)}}var i=new e;exports.default=i;"},"sourceMaps":{"js":{"mappings":[{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":0}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":13}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":20}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":35}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":43}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":56}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":57}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":64}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":68}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":76}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":89}},{"source":"async/territories.js","original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"async/territories.js","original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"async/territories.js","original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"async/territories.js","original":{"line":1,"column":0},"generated":{"line":1,"column":105}},{"source":"async/territories.js","original":{"line":2,"column":0},"generated":{"line":1,"column":115}},{"source":"async/territories.js","original":{"line":2,"column":0},"generated":{"line":1,"column":117}},{"source":"async/territories.js","original":{"line":2,"column":0},"generated":{"line":1,"column":125}},{"source":"async/territories.js","original":{"line":4,"column":0},"generated":{"line":1,"column":138}},{"source":"async/territories.js","name":"TerritoryAsync","original":{"line":4,"column":6},"generated":{"line":1,"column":144}},{"source":"async/territories.js","name":"getTerritory","original":{"line":5,"column":8},"generated":{"line":1,"column":146}},{"source":"async/territories.js","name":"id","original":{"line":5,"column":22},"generated":{"line":1,"column":165}},{"source":"async/territories.js","original":{"line":6,"column":11},"generated":{"line":1,"column":168}},{"source":"async/territories.js","original":{"line":6,"column":11},"generated":{"line":1,"column":175}},{"source":"async/territories.js","original":{"line":6,"column":19},"generated":{"line":1,"column":177}},{"source":"async/territories.js","original":{"line":6,"column":19},"generated":{"line":1,"column":179}},{"source":"async/territories.js","name":"conn","original":{"line":6,"column":25},"generated":{"line":1,"column":194}},{"source":"async/territories.js","name":"query","original":{"line":6,"column":30},"generated":{"line":1,"column":196}},{"source":"async/territories.js","name":"query","original":{"line":6,"column":30},"generated":{"line":1,"column":201}},{"source":"async/territories.js","name":"id","original":{"line":6,"column":74},"generated":{"line":1,"column":245}},{"source":"async/territories.js","original":{"line":6,"column":81},"generated":{"line":1,"column":251}},{"source":"async/territories.js","name":"getTerritories","original":{"line":9,"column":8},"generated":{"line":1,"column":254}},{"source":"async/territories.js","name":"congId","original":{"line":9,"column":24},"generated":{"line":1,"column":275}},{"source":"async/territories.js","original":{"line":10,"column":11},"generated":{"line":1,"column":278}},{"source":"async/territories.js","original":{"line":10,"column":11},"generated":{"line":1,"column":285}},{"source":"async/territories.js","original":{"line":10,"column":19},"generated":{"line":1,"column":287}},{"source":"async/territories.js","original":{"line":10,"column":19},"generated":{"line":1,"column":289}},{"source":"async/territories.js","name":"conn","original":{"line":10,"column":25},"generated":{"line":1,"column":304}},{"source":"async/territories.js","name":"query","original":{"line":10,"column":30},"generated":{"line":1,"column":306}},{"source":"async/territories.js","name":"query","original":{"line":10,"column":30},"generated":{"line":1,"column":311}},{"source":"async/territories.js","name":"congId","original":{"line":10,"column":86},"generated":{"line":1,"column":367}},{"source":"async/territories.js","name":"searchTerritories","original":{"line":13,"column":8},"generated":{"line":1,"column":373}},{"source":"async/territories.js","name":"congId","original":{"line":13,"column":27},"generated":{"line":1,"column":397}},{"source":"async/territories.js","name":"keyword","original":{"line":13,"column":35},"generated":{"line":1,"column":399}},{"source":"async/territories.js","original":{"line":14,"column":11},"generated":{"line":1,"column":402}},{"source":"async/territories.js","original":{"line":14,"column":11},"generated":{"line":1,"column":409}},{"source":"async/territories.js","original":{"line":14,"column":19},"generated":{"line":1,"column":411}},{"source":"async/territories.js","original":{"line":14,"column":19},"generated":{"line":1,"column":413}},{"source":"async/territories.js","name":"conn","original":{"line":14,"column":25},"generated":{"line":1,"column":428}},{"source":"async/territories.js","name":"query","original":{"line":14,"column":30},"generated":{"line":1,"column":430}},{"source":"async/territories.js","name":"query","original":{"line":14,"column":30},"generated":{"line":1,"column":435}},{"source":"async/territories.js","name":"congId","original":{"line":14,"column":86},"generated":{"line":1,"column":491}},{"source":"async/territories.js","name":"keyword","original":{"line":14,"column":108},"generated":{"line":1,"column":508}},{"source":"async/territories.js","name":"keyword","original":{"line":14,"column":143},"generated":{"line":1,"column":537}},{"source":"async/territories.js","name":"getTerritoryStatus","original":{"line":17,"column":8},"generated":{"line":1,"column":545}},{"source":"async/territories.js","name":"congId","original":{"line":17,"column":28},"generated":{"line":1,"column":570}},{"source":"async/territories.js","name":"territoryId","original":{"line":17,"column":36},"generated":{"line":1,"column":572}},{"source":"async/territories.js","name":"username","original":{"line":17,"column":49},"generated":{"line":1,"column":574}},{"source":"async/territories.js","original":{"line":18,"column":11},"generated":{"line":1,"column":577}},{"source":"async/territories.js","original":{"line":18,"column":11},"generated":{"line":1,"column":584}},{"source":"async/territories.js","original":{"line":18,"column":19},"generated":{"line":1,"column":586}},{"source":"async/territories.js","original":{"line":18,"column":19},"generated":{"line":1,"column":588}},{"source":"async/territories.js","name":"conn","original":{"line":18,"column":25},"generated":{"line":1,"column":603}},{"source":"async/territories.js","name":"query","original":{"line":18,"column":30},"generated":{"line":1,"column":605}},{"source":"async/territories.js","name":"query","original":{"line":18,"column":30},"generated":{"line":1,"column":610}},{"source":"async/territories.js","name":"congId","original":{"line":24,"column":33},"generated":{"line":1,"column":930}},{"source":"async/territories.js","name":"territoryId","original":{"line":25,"column":12},"generated":{"line":1,"column":944}},{"source":"async/territories.js","name":"territoryId","original":{"line":25,"column":49},"generated":{"line":1,"column":969}},{"source":"async/territories.js","original":{"line":25,"column":65},"generated":{"line":1,"column":973}},{"source":"async/territories.js","name":"username","original":{"line":26,"column":12},"generated":{"line":1,"column":988}},{"source":"async/territories.js","name":"username","original":{"line":26,"column":43},"generated":{"line":1,"column":1010}},{"source":"async/territories.js","original":{"line":26,"column":57},"generated":{"line":1,"column":1015}},{"source":"async/territories.js","name":"getTerritoriesByUser","original":{"line":31,"column":8},"generated":{"line":1,"column":1030}},{"source":"async/territories.js","name":"congId","original":{"line":31,"column":30},"generated":{"line":1,"column":1057}},{"source":"async/territories.js","name":"username","original":{"line":31,"column":38},"generated":{"line":1,"column":1059}},{"source":"async/territories.js","original":{"line":32,"column":11},"generated":{"line":1,"column":1062}},{"source":"async/territories.js","original":{"line":32,"column":11},"generated":{"line":1,"column":1069}},{"source":"async/territories.js","original":{"line":32,"column":19},"generated":{"line":1,"column":1071}},{"source":"async/territories.js","original":{"line":32,"column":19},"generated":{"line":1,"column":1073}},{"source":"async/territories.js","name":"conn","original":{"line":32,"column":25},"generated":{"line":1,"column":1088}},{"source":"async/territories.js","name":"query","original":{"line":32,"column":30},"generated":{"line":1,"column":1090}},{"source":"async/territories.js","name":"query","original":{"line":32,"column":30},"generated":{"line":1,"column":1095}},{"source":"async/territories.js","name":"congId","original":{"line":37,"column":34},"generated":{"line":1,"column":1260}},{"source":"async/territories.js","name":"username","original":{"line":38,"column":27},"generated":{"line":1,"column":1291}},{"source":"async/territories.js","name":"getMostRecentCheckin","original":{"line":44,"column":8},"generated":{"line":1,"column":1333}},{"source":"async/territories.js","name":"territoryId","original":{"line":44,"column":30},"generated":{"line":1,"column":1360}},{"source":"async/territories.js","name":"username","original":{"line":44,"column":43},"generated":{"line":1,"column":1362}},{"source":"async/territories.js","original":{"line":45,"column":11},"generated":{"line":1,"column":1365}},{"source":"async/territories.js","name":"conn","original":{"line":45,"column":17},"generated":{"line":1,"column":1378}},{"source":"async/territories.js","name":"query","original":{"line":45,"column":22},"generated":{"line":1,"column":1380}},{"source":"async/territories.js","name":"query","original":{"line":45,"column":22},"generated":{"line":1,"column":1385}},{"source":"async/territories.js","name":"territoryId","original":{"line":49,"column":31},"generated":{"line":1,"column":1525}},{"source":"async/territories.js","name":"username","original":{"line":49,"column":62},"generated":{"line":1,"column":1546}},{"source":"async/territories.js","name":"getTerritoriesByCity","original":{"line":57,"column":8},"generated":{"line":1,"column":1643}},{"source":"async/territories.js","name":"congId","original":{"line":57,"column":30},"generated":{"line":1,"column":1670}},{"source":"async/territories.js","name":"city","original":{"line":57,"column":38},"generated":{"line":1,"column":1672}},{"source":"async/territories.js","name":"territoryId","original":{"line":57,"column":44},"generated":{"line":1,"column":1674}},{"source":"async/territories.js","name":"andCity","original":{"line":58,"column":10},"generated":{"line":1,"column":1677}},{"source":"async/territories.js","name":"andCity","original":{"line":58,"column":10},"generated":{"line":1,"column":1683}},{"source":"async/territories.js","name":"city","original":{"line":58,"column":20},"generated":{"line":1,"column":1685}},{"source":"async/territories.js","name":"city","original":{"line":58,"column":43},"generated":{"line":1,"column":1703}},{"source":"async/territories.js","original":{"line":58,"column":54},"generated":{"line":1,"column":1709}},{"source":"async/territories.js","name":"andTerritoryId","original":{"line":59,"column":10},"generated":{"line":1,"column":1712}},{"source":"async/territories.js","name":"territoryId","original":{"line":59,"column":27},"generated":{"line":1,"column":1714}},{"source":"async/territories.js","name":"territoryId","original":{"line":59,"column":52},"generated":{"line":1,"column":1727}},{"source":"async/territories.js","original":{"line":59,"column":68},"generated":{"line":1,"column":1731}},{"source":"async/territories.js","original":{"line":60,"column":11},"generated":{"line":1,"column":1734}},{"source":"async/territories.js","original":{"line":60,"column":11},"generated":{"line":1,"column":1741}},{"source":"async/territories.js","original":{"line":60,"column":19},"generated":{"line":1,"column":1743}},{"source":"async/territories.js","original":{"line":60,"column":19},"generated":{"line":1,"column":1745}},{"source":"async/territories.js","name":"conn","original":{"line":60,"column":25},"generated":{"line":1,"column":1760}},{"source":"async/territories.js","name":"query","original":{"line":60,"column":30},"generated":{"line":1,"column":1762}},{"source":"async/territories.js","name":"query","original":{"line":60,"column":30},"generated":{"line":1,"column":1767}},{"source":"async/territories.js","name":"congId","original":{"line":60,"column":94},"generated":{"line":1,"column":1831}},{"source":"async/territories.js","name":"andCity","original":{"line":60,"column":103},"generated":{"line":1,"column":1835}},{"source":"async/territories.js","name":"andTerritoryId","original":{"line":60,"column":113},"generated":{"line":1,"column":1839}},{"source":"async/territories.js","name":"getTerritoriesByGroupCode","original":{"line":63,"column":8},"generated":{"line":1,"column":1845}},{"source":"async/territories.js","name":"congId","original":{"line":63,"column":35},"generated":{"line":1,"column":1877}},{"source":"async/territories.js","name":"groupCode","original":{"line":63,"column":43},"generated":{"line":1,"column":1879}},{"source":"async/territories.js","original":{"line":64,"column":11},"generated":{"line":1,"column":1882}},{"source":"async/territories.js","original":{"line":64,"column":11},"generated":{"line":1,"column":1889}},{"source":"async/territories.js","original":{"line":64,"column":19},"generated":{"line":1,"column":1891}},{"source":"async/territories.js","original":{"line":64,"column":19},"generated":{"line":1,"column":1893}},{"source":"async/territories.js","name":"conn","original":{"line":64,"column":25},"generated":{"line":1,"column":1908}},{"source":"async/territories.js","name":"query","original":{"line":64,"column":30},"generated":{"line":1,"column":1910}},{"source":"async/territories.js","name":"query","original":{"line":64,"column":30},"generated":{"line":1,"column":1915}},{"source":"async/territories.js","name":"congId","original":{"line":64,"column":94},"generated":{"line":1,"column":1979}},{"source":"async/territories.js","name":"groupCode","original":{"line":64,"column":120},"generated":{"line":1,"column":2000}},{"source":"async/territories.js","name":"saveTerritoryActivity","original":{"line":67,"column":8},"generated":{"line":1,"column":2027}},{"source":"async/territories.js","name":"status","original":{"line":67,"column":30},"generated":{"line":1,"column":2055}},{"source":"async/territories.js","name":"territoryId","original":{"line":67,"column":38},"generated":{"line":1,"column":2057}},{"source":"async/territories.js","name":"publisherId","original":{"line":67,"column":51},"generated":{"line":1,"column":2059}},{"source":"async/territories.js","name":"user","original":{"line":67,"column":64},"generated":{"line":1,"column":2061}},{"source":"async/territories.js","name":"user","original":{"line":68,"column":8},"generated":{"line":1,"column":2064}},{"source":"async/territories.js","name":"conn","original":{"line":69,"column":12},"generated":{"line":1,"column":2072}},{"source":"async/territories.js","name":"query","original":{"line":69,"column":17},"generated":{"line":1,"column":2074}},{"source":"async/territories.js","name":"query","original":{"line":69,"column":17},"generated":{"line":1,"column":2079}},{"source":"async/territories.js","name":"territoryId","original":{"line":69,"column":113},"generated":{"line":1,"column":2175}},{"source":"async/territories.js","name":"publisherId","original":{"line":69,"column":129},"generated":{"line":1,"column":2181}},{"source":"async/territories.js","name":"status","original":{"line":69,"column":146},"generated":{"line":1,"column":2188}},{"source":"async/territories.js","name":"user","original":{"line":69,"column":159},"generated":{"line":1,"column":2196}},{"source":"async/territories.js","name":"conn","original":{"line":71,"column":12},"generated":{"line":1,"column":2209}},{"source":"async/territories.js","name":"query","original":{"line":71,"column":17},"generated":{"line":1,"column":2211}},{"source":"async/territories.js","name":"query","original":{"line":71,"column":17},"generated":{"line":1,"column":2216}},{"source":"async/territories.js","name":"territoryId","original":{"line":71,"column":100},"generated":{"line":1,"column":2299}},{"source":"async/territories.js","name":"publisherId","original":{"line":71,"column":116},"generated":{"line":1,"column":2305}},{"source":"async/territories.js","name":"status","original":{"line":71,"column":133},"generated":{"line":1,"column":2312}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":2320}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":2324}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":2326}},{"source":"async/territories.js","name":"TerritoryAsync","original":{"line":76,"column":19},"generated":{"line":1,"column":2330}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":2332}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":2340}},{"source":"async/territories.js","original":{"line":76,"column":15},"generated":{"line":1,"column":2348}}],"sources":{"async/territories.js":"import { toArray } from 'lodash';\nimport { conn } from '../server';\n\nclass TerritoryAsync {\n  async getTerritory (id) {\n    return toArray(await conn.query(`SELECT * FROM territories WHERE id=${id}`))[0];\n  }\n\n  async getTerritories (congId) {\n    return toArray(await conn.query(`SELECT * FROM territories WHERE congregationid=${congId}`));\n  }\n\n  async searchTerritories (congId, keyword) {\n    return toArray(await conn.query(`SELECT * FROM territories WHERE congregationid=${congId} name LIKE '%${keyword}%' OR description LIKE '%${keyword}%'`));\n  }\n\n  async getTerritoryStatus (congId, territoryId, username) {\n    return toArray(await conn.query(\n      `\n        SELECT ck.*, t.*, ck.id AS checkout_id, t.id AS territory_id, p.username, p.firstname, p.lastname, p.status AS publisher_status\n        FROM territorycheckouts ck\n        JOIN territories t ON ck.territoryid = t.id\n        JOIN publishers p ON ck.publisherid = p.id\n        WHERE t.congregationid=${congId}\n        ${!!territoryId ? ` AND ck.territoryid=${territoryId}` : ''}\n        ${!!username ? ` AND p.username='${username}'` : ''}\n      `\n    ));\n  }\n\n  async getTerritoriesByUser (congId, username) {\n    return toArray(await conn.query(\n      `\n        SELECT ck.*, t.*\n        FROM territorycheckouts_pivot ck\n        JOIN territories t ON ck.territory_id = t.id\n        WHERE ck.congregationid=${congId}\n        AND ck.username='${username}'\n        AND ck.in IS NULL\n      `\n    ));\n  }\n\n  async getMostRecentCheckin (territoryId, username) {\n    return await conn.query(\n      `\n        SELECT ck.* FROM territorycheckouts ck\n        JOIN publishers p ON ck.publisherid = p.id\n        WHERE ck.territoryid=${territoryId} AND p.username='${username}'\n        AND ck.status = 'IN'\n        ORDER BY ck.timestamp DESC\n        LIMIT 1\n      `\n    );\n  }\n\n  async getTerritoriesByCity (congId, city, territoryId) {\n    const andCity = city ? ` city LIKE '%${city}%'` : '';\n    const andTerritoryId = territoryId ? ` AND id=${territoryId}` : '';\n    return toArray(await conn.query(`SELECT * FROM territories_by_city WHERE congregationid=${congId}${andCity}${andTerritoryId}`));\n  }\n\n  async getTerritoriesByGroupCode (congId, groupCode) {\n    return toArray(await conn.query(`SELECT * FROM territories_by_city WHERE congregationid=${congId} AND group_code='${groupCode}' ORDER BY city, name`));\n  }\n\n  async saveTerritoryActivity(status, territoryId, publisherId, user) {\n    if (user) {\n      await conn.query(`INSERT INTO territorycheckouts (territoryid, publisherid, status, create_user) VALUES (${territoryId}, ${publisherId}, '${status}', '${user}')`);    \n    } else {\n      await conn.query(`INSERT INTO territorycheckouts (territoryid, publisherid, status) VALUES (${territoryId}, ${publisherId}, '${status}')`);    \n    }\n  }\n}\n\nexport default new TerritoryAsync();\n"},"lineCount":null}},"error":null,"hash":"2d79c81ab0d9f15d50c047ab3d5dad4b","cacheData":{"env":{}}}