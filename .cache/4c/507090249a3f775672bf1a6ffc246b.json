{"id":"KMSr","dependencies":[{"name":"/Users/ryan.tercias/MyApps/territory-data-service/package.json","includedInParent":true,"mtime":1592367476738},{"name":"../server","loc":{"line":2,"column":21},"parent":"/Users/ryan.tercias/MyApps/territory-data-service/src/async/addresses.js","resolved":"/Users/ryan.tercias/MyApps/territory-data-service/src/server.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=require(\"lodash\"),t=require(\"../server\");class r{constructor(){this.aliases=\"\\n      congregationid as congregationId,\\n      create_user as create_username,\\n      update_user as update_username\\n    \"}async getAddress(e,r=\"Active\"){const n=\"*\"===r?\"\":` AND status='${r}'`,s=`SELECT *, ${this.aliases} FROM addresses WHERE id=${e}${n}`;return(await t.conn.query(s))[0]}async getAddressesByTerritory(r,n=\"Active\"){const s=\"*\"===n?\"\":\"!Active\"===n?\" AND NOT status = 'Active'\":` AND status = '${n}'`,a=`SELECT *, ${this.aliases} FROM addresses WHERE territory_id=${r}${s}`;return(0,e.toArray)(await t.conn.query(a))}async searchAddresses(r,n,s=\"Active\"){const a=\"*\"===s?\"\":\"!Active\"===s?\" AND NOT status = 'Active'\":` AND status = '${s}'`,d=`SELECT *, ${this.aliases} FROM addresses \\n    WHERE congregationid=${r}${a} AND (addr1 LIKE '%${n}%' OR addr2 LIKE '%${n}%')`;return(0,e.toArray)(await t.conn.query(d))}async getDNC(r){const n=`SELECT *, ${this.aliases} FROM addresses WHERE congregationid=${r} AND status='DNC'`;return(0,e.toArray)(await t.conn.query(n))}async create(r){if(!r.congregationId)throw new Error(\"congregation id is required\");return(await t.conn.query(`INSERT INTO addresses (\\n      congregationid,\\n      territory_id,\\n      status,\\n      sort,\\n      addr1,\\n      addr2,\\n      city,\\n      state_province,\\n      postal_code,\\n      phone,\\n      longitude,\\n      latitude,\\n      notes,\\n      create_user,\\n      create_date\\n    ) VALUES (\\n      ${(0,e.get)(r,\"congregationId\",\"\")},\\n      ${(0,e.get)(r,\"territory_id\",\"\")},\\n      '${(0,e.get)(r,\"status\",\"Active\")}',\\n      ${(0,e.get)(r,\"sort\",\"\")},\\n      '${(0,e.get)(r,\"addr1\",\"\")}',\\n      '${(0,e.get)(r,\"addr2\",\"\")}',\\n      '${(0,e.get)(r,\"city\",\"\")}',\\n      '${(0,e.get)(r,\"state_province\",\"\")}',\\n      '${(0,e.get)(r,\"postal_code\",\"\")}',\\n      '${(0,e.get)(r,\"phone\",\"\")}',\\n      ${(0,e.get)(r,\"longitude\",\"NULL\")},\\n      ${(0,e.get)(r,\"latitude\",\"NULL\")},\\n      '${(0,e.get)(r,\"notes\",\"\")}',\\n      ${(0,e.get)(r,\"create_user\",\"\")},\\n      NOW()\\n    )`)).insertId}async update(e){if(!e||!e.id)throw new Error(\"Address id is required\");const r=`UPDATE addresses SET\\n      ${e.congregationId?`congregationid = ${e.congregationId},`:\"\"}\\n      ${e.territory_id?`territory_id = ${e.territory_id},`:\"\"}\\n      ${e.status?`status = '${e.status}',`:\"\"}\\n      ${e.sort?`sort = ${e.sort},`:\"\"}\\n      ${e.addr1?`addr1 = '${e.addr1}',`:\"\"}\\n      ${e.addr2?`addr2 = '${e.addr2}',`:\"\"}\\n      ${e.city?`city = '${e.city}',`:\"\"}\\n      ${e.state_province?`state_province = '${e.state_province}',`:\"\"}\\n      ${e.postal_code?`postal_code = '${e.postal_code}',`:\"\"}\\n      ${e.phone?`phone = '${e.phone}',`:\"\"}\\n      ${e.latitude?`latitude = ${e.latitude},`:\"\"}\\n      ${e.longitude?`longitude = ${e.longitude},`:\"\"}\\n      ${e.notes?`notes = '${e.notes}',`:\"\"}\\n      ${e.update_user?`update_user = ${e.update_user},`:\"\"}\\n      update_date = NOW()\\n    WHERE id = ${e.id}`;await t.conn.query(r)}async changeStatus(e,r,n,s){if(!e)throw new Error(\"id is required\");if(!r)throw new Error(\"status is required\");if(!n)throw new Error(\"userid is required\");const a=`UPDATE addresses SET \\n      status = '${r}', update_user = ${n} ${s?`, notes = '${s}'`:\"\"}\\n      WHERE id=${e}`;await t.conn.query(a)}}var n=new r;exports.default=n;"},"sourceMaps":{"js":{"mappings":[{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":0}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":13}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":20}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":35}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":43}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":56}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":57}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":64}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":68}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":76}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":89}},{"source":"async/addresses.js","original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"async/addresses.js","original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"async/addresses.js","original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"async/addresses.js","original":{"line":1,"column":0},"generated":{"line":1,"column":105}},{"source":"async/addresses.js","original":{"line":2,"column":0},"generated":{"line":1,"column":115}},{"source":"async/addresses.js","original":{"line":2,"column":0},"generated":{"line":1,"column":117}},{"source":"async/addresses.js","original":{"line":2,"column":0},"generated":{"line":1,"column":125}},{"source":"async/addresses.js","original":{"line":4,"column":0},"generated":{"line":1,"column":138}},{"source":"async/addresses.js","name":"AddressAsync","original":{"line":4,"column":6},"generated":{"line":1,"column":144}},{"source":"async/addresses.js","name":"constructor","original":{"line":5,"column":2},"generated":{"line":1,"column":146}},{"source":"async/addresses.js","name":"aliases","original":{"line":6,"column":9},"generated":{"line":1,"column":160}},{"source":"async/addresses.js","name":"aliases","original":{"line":6,"column":9},"generated":{"line":1,"column":165}},{"source":"async/addresses.js","original":{"line":6,"column":20},"generated":{"line":1,"column":173}},{"source":"async/addresses.js","name":"getAddress","original":{"line":13,"column":8},"generated":{"line":1,"column":300}},{"source":"async/addresses.js","name":"id","original":{"line":13,"column":20},"generated":{"line":1,"column":317}},{"source":"async/addresses.js","name":"status","original":{"line":13,"column":24},"generated":{"line":1,"column":319}},{"source":"async/addresses.js","original":{"line":13,"column":33},"generated":{"line":1,"column":321}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":14,"column":10},"generated":{"line":1,"column":331}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":14,"column":10},"generated":{"line":1,"column":337}},{"source":"async/addresses.js","original":{"line":14,"column":39},"generated":{"line":1,"column":339}},{"source":"async/addresses.js","name":"status","original":{"line":14,"column":28},"generated":{"line":1,"column":345}},{"source":"async/addresses.js","original":{"line":14,"column":45},"generated":{"line":1,"column":347}},{"source":"async/addresses.js","name":"status","original":{"line":14,"column":66},"generated":{"line":1,"column":366}},{"source":"async/addresses.js","name":"sql","original":{"line":15,"column":10},"generated":{"line":1,"column":371}},{"source":"async/addresses.js","original":{"line":15,"column":29},"generated":{"line":1,"column":386}},{"source":"async/addresses.js","name":"aliases","original":{"line":15,"column":34},"generated":{"line":1,"column":391}},{"source":"async/addresses.js","name":"id","original":{"line":15,"column":69},"generated":{"line":1,"column":426}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":15,"column":74},"generated":{"line":1,"column":430}},{"source":"async/addresses.js","original":{"line":16,"column":11},"generated":{"line":1,"column":434}},{"source":"async/addresses.js","name":"conn","original":{"line":16,"column":18},"generated":{"line":1,"column":447}},{"source":"async/addresses.js","name":"query","original":{"line":16,"column":23},"generated":{"line":1,"column":449}},{"source":"async/addresses.js","name":"query","original":{"line":16,"column":23},"generated":{"line":1,"column":454}},{"source":"async/addresses.js","name":"sql","original":{"line":16,"column":29},"generated":{"line":1,"column":460}},{"source":"async/addresses.js","original":{"line":16,"column":35},"generated":{"line":1,"column":464}},{"source":"async/addresses.js","name":"getAddressesByTerritory","original":{"line":19,"column":8},"generated":{"line":1,"column":467}},{"source":"async/addresses.js","name":"terrId","original":{"line":19,"column":33},"generated":{"line":1,"column":497}},{"source":"async/addresses.js","name":"status","original":{"line":19,"column":41},"generated":{"line":1,"column":499}},{"source":"async/addresses.js","original":{"line":19,"column":50},"generated":{"line":1,"column":501}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":20,"column":10},"generated":{"line":1,"column":511}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":20,"column":10},"generated":{"line":1,"column":517}},{"source":"async/addresses.js","original":{"line":21,"column":17},"generated":{"line":1,"column":519}},{"source":"async/addresses.js","name":"status","original":{"line":21,"column":6},"generated":{"line":1,"column":525}},{"source":"async/addresses.js","original":{"line":21,"column":23},"generated":{"line":1,"column":527}},{"source":"async/addresses.js","original":{"line":22,"column":17},"generated":{"line":1,"column":530}},{"source":"async/addresses.js","name":"status","original":{"line":22,"column":6},"generated":{"line":1,"column":542}},{"source":"async/addresses.js","original":{"line":22,"column":30},"generated":{"line":1,"column":544}},{"source":"async/addresses.js","name":"status","original":{"line":23,"column":24},"generated":{"line":1,"column":591}},{"source":"async/addresses.js","name":"sql","original":{"line":25,"column":10},"generated":{"line":1,"column":596}},{"source":"async/addresses.js","original":{"line":25,"column":29},"generated":{"line":1,"column":611}},{"source":"async/addresses.js","name":"aliases","original":{"line":25,"column":34},"generated":{"line":1,"column":616}},{"source":"async/addresses.js","name":"terrId","original":{"line":25,"column":79},"generated":{"line":1,"column":661}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":25,"column":88},"generated":{"line":1,"column":665}},{"source":"async/addresses.js","original":{"line":27,"column":11},"generated":{"line":1,"column":669}},{"source":"async/addresses.js","original":{"line":27,"column":11},"generated":{"line":1,"column":676}},{"source":"async/addresses.js","original":{"line":27,"column":19},"generated":{"line":1,"column":678}},{"source":"async/addresses.js","original":{"line":27,"column":19},"generated":{"line":1,"column":680}},{"source":"async/addresses.js","name":"conn","original":{"line":27,"column":25},"generated":{"line":1,"column":695}},{"source":"async/addresses.js","name":"query","original":{"line":27,"column":30},"generated":{"line":1,"column":697}},{"source":"async/addresses.js","name":"query","original":{"line":27,"column":30},"generated":{"line":1,"column":702}},{"source":"async/addresses.js","name":"sql","original":{"line":27,"column":36},"generated":{"line":1,"column":708}},{"source":"async/addresses.js","name":"searchAddresses","original":{"line":30,"column":8},"generated":{"line":1,"column":712}},{"source":"async/addresses.js","name":"congId","original":{"line":30,"column":25},"generated":{"line":1,"column":734}},{"source":"async/addresses.js","name":"keyword","original":{"line":30,"column":33},"generated":{"line":1,"column":736}},{"source":"async/addresses.js","name":"status","original":{"line":30,"column":42},"generated":{"line":1,"column":738}},{"source":"async/addresses.js","original":{"line":30,"column":51},"generated":{"line":1,"column":740}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":31,"column":10},"generated":{"line":1,"column":750}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":31,"column":10},"generated":{"line":1,"column":756}},{"source":"async/addresses.js","original":{"line":31,"column":39},"generated":{"line":1,"column":758}},{"source":"async/addresses.js","name":"status","original":{"line":31,"column":28},"generated":{"line":1,"column":764}},{"source":"async/addresses.js","original":{"line":31,"column":45},"generated":{"line":1,"column":766}},{"source":"async/addresses.js","original":{"line":32,"column":17},"generated":{"line":1,"column":769}},{"source":"async/addresses.js","name":"status","original":{"line":32,"column":6},"generated":{"line":1,"column":781}},{"source":"async/addresses.js","original":{"line":32,"column":30},"generated":{"line":1,"column":783}},{"source":"async/addresses.js","name":"status","original":{"line":33,"column":24},"generated":{"line":1,"column":830}},{"source":"async/addresses.js","name":"sql","original":{"line":35,"column":10},"generated":{"line":1,"column":835}},{"source":"async/addresses.js","original":{"line":35,"column":29},"generated":{"line":1,"column":850}},{"source":"async/addresses.js","name":"aliases","original":{"line":35,"column":34},"generated":{"line":1,"column":855}},{"source":"async/addresses.js","name":"congId","original":{"line":36,"column":27},"generated":{"line":1,"column":908}},{"source":"async/addresses.js","name":"statusCondition","original":{"line":36,"column":36},"generated":{"line":1,"column":912}},{"source":"async/addresses.js","name":"keyword","original":{"line":36,"column":73},"generated":{"line":1,"column":935}},{"source":"async/addresses.js","name":"keyword","original":{"line":36,"column":102},"generated":{"line":1,"column":958}},{"source":"async/addresses.js","original":{"line":37,"column":11},"generated":{"line":1,"column":965}},{"source":"async/addresses.js","original":{"line":37,"column":11},"generated":{"line":1,"column":972}},{"source":"async/addresses.js","original":{"line":37,"column":19},"generated":{"line":1,"column":974}},{"source":"async/addresses.js","original":{"line":37,"column":19},"generated":{"line":1,"column":976}},{"source":"async/addresses.js","name":"conn","original":{"line":37,"column":25},"generated":{"line":1,"column":991}},{"source":"async/addresses.js","name":"query","original":{"line":37,"column":30},"generated":{"line":1,"column":993}},{"source":"async/addresses.js","name":"query","original":{"line":37,"column":30},"generated":{"line":1,"column":998}},{"source":"async/addresses.js","name":"sql","original":{"line":37,"column":36},"generated":{"line":1,"column":1004}},{"source":"async/addresses.js","name":"getDNC","original":{"line":40,"column":8},"generated":{"line":1,"column":1008}},{"source":"async/addresses.js","name":"congId","original":{"line":40,"column":16},"generated":{"line":1,"column":1021}},{"source":"async/addresses.js","name":"sql","original":{"line":41,"column":10},"generated":{"line":1,"column":1024}},{"source":"async/addresses.js","name":"sql","original":{"line":41,"column":10},"generated":{"line":1,"column":1030}},{"source":"async/addresses.js","original":{"line":41,"column":29},"generated":{"line":1,"column":1045}},{"source":"async/addresses.js","name":"aliases","original":{"line":41,"column":34},"generated":{"line":1,"column":1050}},{"source":"async/addresses.js","name":"congId","original":{"line":41,"column":81},"generated":{"line":1,"column":1097}},{"source":"async/addresses.js","original":{"line":42,"column":11},"generated":{"line":1,"column":1118}},{"source":"async/addresses.js","original":{"line":42,"column":11},"generated":{"line":1,"column":1125}},{"source":"async/addresses.js","original":{"line":42,"column":19},"generated":{"line":1,"column":1127}},{"source":"async/addresses.js","original":{"line":42,"column":19},"generated":{"line":1,"column":1129}},{"source":"async/addresses.js","name":"conn","original":{"line":42,"column":25},"generated":{"line":1,"column":1144}},{"source":"async/addresses.js","name":"query","original":{"line":42,"column":30},"generated":{"line":1,"column":1146}},{"source":"async/addresses.js","name":"query","original":{"line":42,"column":30},"generated":{"line":1,"column":1151}},{"source":"async/addresses.js","name":"sql","original":{"line":42,"column":36},"generated":{"line":1,"column":1157}},{"source":"async/addresses.js","name":"create","original":{"line":45,"column":8},"generated":{"line":1,"column":1161}},{"source":"async/addresses.js","name":"address","original":{"line":45,"column":16},"generated":{"line":1,"column":1174}},{"source":"async/addresses.js","original":{"line":46,"column":8},"generated":{"line":1,"column":1177}},{"source":"async/addresses.js","name":"address","original":{"line":46,"column":9},"generated":{"line":1,"column":1181}},{"source":"async/addresses.js","name":"congregationId","original":{"line":46,"column":17},"generated":{"line":1,"column":1183}},{"source":"async/addresses.js","original":{"line":47,"column":12},"generated":{"line":1,"column":1198}},{"source":"async/addresses.js","original":{"line":47,"column":12},"generated":{"line":1,"column":1204}},{"source":"async/addresses.js","name":"Error","original":{"line":47,"column":16},"generated":{"line":1,"column":1208}},{"source":"async/addresses.js","original":{"line":47,"column":22},"generated":{"line":1,"column":1214}},{"source":"async/addresses.js","name":"results","original":{"line":84,"column":11},"generated":{"line":1,"column":1245}},{"source":"async/addresses.js","name":"conn","original":{"line":50,"column":26},"generated":{"line":1,"column":1258}},{"source":"async/addresses.js","name":"query","original":{"line":50,"column":31},"generated":{"line":1,"column":1260}},{"source":"async/addresses.js","name":"query","original":{"line":50,"column":31},"generated":{"line":1,"column":1265}},{"source":"async/addresses.js","original":{"line":67,"column":9},"generated":{"line":1,"column":1580}},{"source":"async/addresses.js","name":"address","original":{"line":67,"column":13},"generated":{"line":1,"column":1582}},{"source":"async/addresses.js","name":"address","original":{"line":67,"column":13},"generated":{"line":1,"column":1584}},{"source":"async/addresses.js","name":"address","original":{"line":67,"column":13},"generated":{"line":1,"column":1589}},{"source":"async/addresses.js","original":{"line":67,"column":22},"generated":{"line":1,"column":1591}},{"source":"async/addresses.js","original":{"line":67,"column":40},"generated":{"line":1,"column":1608}},{"source":"async/addresses.js","original":{"line":68,"column":9},"generated":{"line":1,"column":1624}},{"source":"async/addresses.js","name":"address","original":{"line":68,"column":13},"generated":{"line":1,"column":1626}},{"source":"async/addresses.js","name":"address","original":{"line":68,"column":13},"generated":{"line":1,"column":1628}},{"source":"async/addresses.js","name":"address","original":{"line":68,"column":13},"generated":{"line":1,"column":1633}},{"source":"async/addresses.js","original":{"line":68,"column":22},"generated":{"line":1,"column":1635}},{"source":"async/addresses.js","original":{"line":68,"column":38},"generated":{"line":1,"column":1650}},{"source":"async/addresses.js","original":{"line":69,"column":10},"generated":{"line":1,"column":1667}},{"source":"async/addresses.js","name":"address","original":{"line":69,"column":14},"generated":{"line":1,"column":1669}},{"source":"async/addresses.js","name":"address","original":{"line":69,"column":14},"generated":{"line":1,"column":1671}},{"source":"async/addresses.js","name":"address","original":{"line":69,"column":14},"generated":{"line":1,"column":1676}},{"source":"async/addresses.js","original":{"line":69,"column":23},"generated":{"line":1,"column":1678}},{"source":"async/addresses.js","original":{"line":69,"column":33},"generated":{"line":1,"column":1687}},{"source":"async/addresses.js","original":{"line":70,"column":9},"generated":{"line":1,"column":1710}},{"source":"async/addresses.js","name":"address","original":{"line":70,"column":13},"generated":{"line":1,"column":1712}},{"source":"async/addresses.js","name":"address","original":{"line":70,"column":13},"generated":{"line":1,"column":1714}},{"source":"async/addresses.js","name":"address","original":{"line":70,"column":13},"generated":{"line":1,"column":1719}},{"source":"async/addresses.js","original":{"line":70,"column":22},"generated":{"line":1,"column":1721}},{"source":"async/addresses.js","original":{"line":70,"column":30},"generated":{"line":1,"column":1728}},{"source":"async/addresses.js","original":{"line":71,"column":10},"generated":{"line":1,"column":1745}},{"source":"async/addresses.js","name":"address","original":{"line":71,"column":14},"generated":{"line":1,"column":1747}},{"source":"async/addresses.js","name":"address","original":{"line":71,"column":14},"generated":{"line":1,"column":1749}},{"source":"async/addresses.js","name":"address","original":{"line":71,"column":14},"generated":{"line":1,"column":1754}},{"source":"async/addresses.js","original":{"line":71,"column":23},"generated":{"line":1,"column":1756}},{"source":"async/addresses.js","original":{"line":71,"column":32},"generated":{"line":1,"column":1764}},{"source":"async/addresses.js","original":{"line":72,"column":10},"generated":{"line":1,"column":1782}},{"source":"async/addresses.js","name":"address","original":{"line":72,"column":14},"generated":{"line":1,"column":1784}},{"source":"async/addresses.js","name":"address","original":{"line":72,"column":14},"generated":{"line":1,"column":1786}},{"source":"async/addresses.js","name":"address","original":{"line":72,"column":14},"generated":{"line":1,"column":1791}},{"source":"async/addresses.js","original":{"line":72,"column":23},"generated":{"line":1,"column":1793}},{"source":"async/addresses.js","original":{"line":72,"column":32},"generated":{"line":1,"column":1801}},{"source":"async/addresses.js","original":{"line":73,"column":10},"generated":{"line":1,"column":1819}},{"source":"async/addresses.js","name":"address","original":{"line":73,"column":14},"generated":{"line":1,"column":1821}},{"source":"async/addresses.js","name":"address","original":{"line":73,"column":14},"generated":{"line":1,"column":1823}},{"source":"async/addresses.js","name":"address","original":{"line":73,"column":14},"generated":{"line":1,"column":1828}},{"source":"async/addresses.js","original":{"line":73,"column":23},"generated":{"line":1,"column":1830}},{"source":"async/addresses.js","original":{"line":73,"column":31},"generated":{"line":1,"column":1837}},{"source":"async/addresses.js","original":{"line":74,"column":10},"generated":{"line":1,"column":1855}},{"source":"async/addresses.js","name":"address","original":{"line":74,"column":14},"generated":{"line":1,"column":1857}},{"source":"async/addresses.js","name":"address","original":{"line":74,"column":14},"generated":{"line":1,"column":1859}},{"source":"async/addresses.js","name":"address","original":{"line":74,"column":14},"generated":{"line":1,"column":1864}},{"source":"async/addresses.js","original":{"line":74,"column":23},"generated":{"line":1,"column":1866}},{"source":"async/addresses.js","original":{"line":74,"column":41},"generated":{"line":1,"column":1883}},{"source":"async/addresses.js","original":{"line":75,"column":10},"generated":{"line":1,"column":1901}},{"source":"async/addresses.js","name":"address","original":{"line":75,"column":14},"generated":{"line":1,"column":1903}},{"source":"async/addresses.js","name":"address","original":{"line":75,"column":14},"generated":{"line":1,"column":1905}},{"source":"async/addresses.js","name":"address","original":{"line":75,"column":14},"generated":{"line":1,"column":1910}},{"source":"async/addresses.js","original":{"line":75,"column":23},"generated":{"line":1,"column":1912}},{"source":"async/addresses.js","original":{"line":75,"column":38},"generated":{"line":1,"column":1926}},{"source":"async/addresses.js","original":{"line":76,"column":10},"generated":{"line":1,"column":1944}},{"source":"async/addresses.js","name":"address","original":{"line":76,"column":14},"generated":{"line":1,"column":1946}},{"source":"async/addresses.js","name":"address","original":{"line":76,"column":14},"generated":{"line":1,"column":1948}},{"source":"async/addresses.js","name":"address","original":{"line":76,"column":14},"generated":{"line":1,"column":1953}},{"source":"async/addresses.js","original":{"line":76,"column":23},"generated":{"line":1,"column":1955}},{"source":"async/addresses.js","original":{"line":76,"column":32},"generated":{"line":1,"column":1963}},{"source":"async/addresses.js","original":{"line":77,"column":9},"generated":{"line":1,"column":1980}},{"source":"async/addresses.js","name":"address","original":{"line":77,"column":13},"generated":{"line":1,"column":1982}},{"source":"async/addresses.js","name":"address","original":{"line":77,"column":13},"generated":{"line":1,"column":1984}},{"source":"async/addresses.js","name":"address","original":{"line":77,"column":13},"generated":{"line":1,"column":1989}},{"source":"async/addresses.js","original":{"line":77,"column":22},"generated":{"line":1,"column":1991}},{"source":"async/addresses.js","original":{"line":77,"column":35},"generated":{"line":1,"column":2003}},{"source":"async/addresses.js","original":{"line":78,"column":9},"generated":{"line":1,"column":2023}},{"source":"async/addresses.js","name":"address","original":{"line":78,"column":13},"generated":{"line":1,"column":2025}},{"source":"async/addresses.js","name":"address","original":{"line":78,"column":13},"generated":{"line":1,"column":2027}},{"source":"async/addresses.js","name":"address","original":{"line":78,"column":13},"generated":{"line":1,"column":2032}},{"source":"async/addresses.js","original":{"line":78,"column":22},"generated":{"line":1,"column":2034}},{"source":"async/addresses.js","original":{"line":78,"column":34},"generated":{"line":1,"column":2045}},{"source":"async/addresses.js","original":{"line":79,"column":10},"generated":{"line":1,"column":2066}},{"source":"async/addresses.js","name":"address","original":{"line":79,"column":14},"generated":{"line":1,"column":2068}},{"source":"async/addresses.js","name":"address","original":{"line":79,"column":14},"generated":{"line":1,"column":2070}},{"source":"async/addresses.js","name":"address","original":{"line":79,"column":14},"generated":{"line":1,"column":2075}},{"source":"async/addresses.js","original":{"line":79,"column":23},"generated":{"line":1,"column":2077}},{"source":"async/addresses.js","original":{"line":79,"column":32},"generated":{"line":1,"column":2085}},{"source":"async/addresses.js","original":{"line":80,"column":9},"generated":{"line":1,"column":2102}},{"source":"async/addresses.js","name":"address","original":{"line":80,"column":13},"generated":{"line":1,"column":2104}},{"source":"async/addresses.js","name":"address","original":{"line":80,"column":13},"generated":{"line":1,"column":2106}},{"source":"async/addresses.js","name":"address","original":{"line":80,"column":13},"generated":{"line":1,"column":2111}},{"source":"async/addresses.js","original":{"line":80,"column":22},"generated":{"line":1,"column":2113}},{"source":"async/addresses.js","original":{"line":80,"column":37},"generated":{"line":1,"column":2127}},{"source":"async/addresses.js","name":"insertId","original":{"line":84,"column":19},"generated":{"line":1,"column":2156}},{"source":"async/addresses.js","name":"update","original":{"line":87,"column":8},"generated":{"line":1,"column":2165}},{"source":"async/addresses.js","name":"address","original":{"line":87,"column":16},"generated":{"line":1,"column":2178}},{"source":"async/addresses.js","original":{"line":88,"column":8},"generated":{"line":1,"column":2181}},{"source":"async/addresses.js","name":"address","original":{"line":88,"column":10},"generated":{"line":1,"column":2185}},{"source":"async/addresses.js","name":"address","original":{"line":88,"column":21},"generated":{"line":1,"column":2189}},{"source":"async/addresses.js","name":"id","original":{"line":88,"column":29},"generated":{"line":1,"column":2191}},{"source":"async/addresses.js","original":{"line":89,"column":12},"generated":{"line":1,"column":2194}},{"source":"async/addresses.js","original":{"line":89,"column":12},"generated":{"line":1,"column":2200}},{"source":"async/addresses.js","name":"Error","original":{"line":89,"column":16},"generated":{"line":1,"column":2204}},{"source":"async/addresses.js","original":{"line":89,"column":22},"generated":{"line":1,"column":2210}},{"source":"async/addresses.js","name":"sql","original":{"line":92,"column":10},"generated":{"line":1,"column":2236}},{"source":"async/addresses.js","name":"sql","original":{"line":92,"column":10},"generated":{"line":1,"column":2242}},{"source":"async/addresses.js","name":"address","original":{"line":93,"column":9},"generated":{"line":1,"column":2275}},{"source":"async/addresses.js","name":"congregationId","original":{"line":93,"column":17},"generated":{"line":1,"column":2277}},{"source":"async/addresses.js","name":"address","original":{"line":93,"column":54},"generated":{"line":1,"column":2312}},{"source":"async/addresses.js","name":"congregationId","original":{"line":93,"column":62},"generated":{"line":1,"column":2314}},{"source":"async/addresses.js","original":{"line":93,"column":82},"generated":{"line":1,"column":2332}},{"source":"async/addresses.js","name":"address","original":{"line":94,"column":9},"generated":{"line":1,"column":2345}},{"source":"async/addresses.js","name":"territory_id","original":{"line":94,"column":17},"generated":{"line":1,"column":2347}},{"source":"async/addresses.js","name":"address","original":{"line":94,"column":50},"generated":{"line":1,"column":2378}},{"source":"async/addresses.js","name":"territory_id","original":{"line":94,"column":58},"generated":{"line":1,"column":2380}},{"source":"async/addresses.js","original":{"line":94,"column":76},"generated":{"line":1,"column":2396}},{"source":"async/addresses.js","name":"address","original":{"line":95,"column":9},"generated":{"line":1,"column":2409}},{"source":"async/addresses.js","name":"status","original":{"line":95,"column":17},"generated":{"line":1,"column":2411}},{"source":"async/addresses.js","name":"address","original":{"line":95,"column":39},"generated":{"line":1,"column":2431}},{"source":"async/addresses.js","name":"status","original":{"line":95,"column":47},"generated":{"line":1,"column":2433}},{"source":"async/addresses.js","original":{"line":95,"column":60},"generated":{"line":1,"column":2444}},{"source":"async/addresses.js","name":"address","original":{"line":96,"column":9},"generated":{"line":1,"column":2457}},{"source":"async/addresses.js","name":"sort","original":{"line":96,"column":17},"generated":{"line":1,"column":2459}},{"source":"async/addresses.js","name":"address","original":{"line":96,"column":34},"generated":{"line":1,"column":2474}},{"source":"async/addresses.js","name":"sort","original":{"line":96,"column":42},"generated":{"line":1,"column":2476}},{"source":"async/addresses.js","original":{"line":96,"column":52},"generated":{"line":1,"column":2484}},{"source":"async/addresses.js","name":"address","original":{"line":97,"column":9},"generated":{"line":1,"column":2497}},{"source":"async/addresses.js","name":"addr1","original":{"line":97,"column":17},"generated":{"line":1,"column":2499}},{"source":"async/addresses.js","name":"address","original":{"line":97,"column":37},"generated":{"line":1,"column":2517}},{"source":"async/addresses.js","name":"addr1","original":{"line":97,"column":45},"generated":{"line":1,"column":2519}},{"source":"async/addresses.js","original":{"line":97,"column":57},"generated":{"line":1,"column":2529}},{"source":"async/addresses.js","name":"address","original":{"line":98,"column":9},"generated":{"line":1,"column":2542}},{"source":"async/addresses.js","name":"addr2","original":{"line":98,"column":17},"generated":{"line":1,"column":2544}},{"source":"async/addresses.js","name":"address","original":{"line":98,"column":37},"generated":{"line":1,"column":2562}},{"source":"async/addresses.js","name":"addr2","original":{"line":98,"column":45},"generated":{"line":1,"column":2564}},{"source":"async/addresses.js","original":{"line":98,"column":57},"generated":{"line":1,"column":2574}},{"source":"async/addresses.js","name":"address","original":{"line":99,"column":9},"generated":{"line":1,"column":2587}},{"source":"async/addresses.js","name":"city","original":{"line":99,"column":17},"generated":{"line":1,"column":2589}},{"source":"async/addresses.js","name":"address","original":{"line":99,"column":35},"generated":{"line":1,"column":2605}},{"source":"async/addresses.js","name":"city","original":{"line":99,"column":43},"generated":{"line":1,"column":2607}},{"source":"async/addresses.js","original":{"line":99,"column":54},"generated":{"line":1,"column":2616}},{"source":"async/addresses.js","name":"address","original":{"line":100,"column":9},"generated":{"line":1,"column":2629}},{"source":"async/addresses.js","name":"state_province","original":{"line":100,"column":17},"generated":{"line":1,"column":2631}},{"source":"async/addresses.js","name":"address","original":{"line":100,"column":55},"generated":{"line":1,"column":2667}},{"source":"async/addresses.js","name":"state_province","original":{"line":100,"column":63},"generated":{"line":1,"column":2669}},{"source":"async/addresses.js","original":{"line":100,"column":84},"generated":{"line":1,"column":2688}},{"source":"async/addresses.js","name":"address","original":{"line":101,"column":9},"generated":{"line":1,"column":2701}},{"source":"async/addresses.js","name":"postal_code","original":{"line":101,"column":17},"generated":{"line":1,"column":2703}},{"source":"async/addresses.js","name":"address","original":{"line":101,"column":49},"generated":{"line":1,"column":2733}},{"source":"async/addresses.js","name":"postal_code","original":{"line":101,"column":57},"generated":{"line":1,"column":2735}},{"source":"async/addresses.js","original":{"line":101,"column":75},"generated":{"line":1,"column":2751}},{"source":"async/addresses.js","name":"address","original":{"line":102,"column":9},"generated":{"line":1,"column":2764}},{"source":"async/addresses.js","name":"phone","original":{"line":102,"column":17},"generated":{"line":1,"column":2766}},{"source":"async/addresses.js","name":"address","original":{"line":102,"column":37},"generated":{"line":1,"column":2784}},{"source":"async/addresses.js","name":"phone","original":{"line":102,"column":45},"generated":{"line":1,"column":2786}},{"source":"async/addresses.js","original":{"line":102,"column":57},"generated":{"line":1,"column":2796}},{"source":"async/addresses.js","name":"address","original":{"line":103,"column":9},"generated":{"line":1,"column":2809}},{"source":"async/addresses.js","name":"latitude","original":{"line":103,"column":17},"generated":{"line":1,"column":2811}},{"source":"async/addresses.js","name":"address","original":{"line":103,"column":42},"generated":{"line":1,"column":2834}},{"source":"async/addresses.js","name":"latitude","original":{"line":103,"column":50},"generated":{"line":1,"column":2836}},{"source":"async/addresses.js","original":{"line":103,"column":64},"generated":{"line":1,"column":2848}},{"source":"async/addresses.js","name":"address","original":{"line":104,"column":9},"generated":{"line":1,"column":2861}},{"source":"async/addresses.js","name":"longitude","original":{"line":104,"column":17},"generated":{"line":1,"column":2863}},{"source":"async/addresses.js","name":"address","original":{"line":104,"column":44},"generated":{"line":1,"column":2888}},{"source":"async/addresses.js","name":"longitude","original":{"line":104,"column":52},"generated":{"line":1,"column":2890}},{"source":"async/addresses.js","original":{"line":104,"column":67},"generated":{"line":1,"column":2903}},{"source":"async/addresses.js","name":"address","original":{"line":105,"column":9},"generated":{"line":1,"column":2916}},{"source":"async/addresses.js","name":"notes","original":{"line":105,"column":17},"generated":{"line":1,"column":2918}},{"source":"async/addresses.js","name":"address","original":{"line":105,"column":37},"generated":{"line":1,"column":2936}},{"source":"async/addresses.js","name":"notes","original":{"line":105,"column":45},"generated":{"line":1,"column":2938}},{"source":"async/addresses.js","original":{"line":105,"column":57},"generated":{"line":1,"column":2948}},{"source":"async/addresses.js","name":"address","original":{"line":106,"column":9},"generated":{"line":1,"column":2961}},{"source":"async/addresses.js","name":"update_user","original":{"line":106,"column":17},"generated":{"line":1,"column":2963}},{"source":"async/addresses.js","name":"address","original":{"line":106,"column":48},"generated":{"line":1,"column":2992}},{"source":"async/addresses.js","name":"update_user","original":{"line":106,"column":56},"generated":{"line":1,"column":2994}},{"source":"async/addresses.js","original":{"line":106,"column":73},"generated":{"line":1,"column":3009}},{"source":"async/addresses.js","name":"address","original":{"line":108,"column":17},"generated":{"line":1,"column":3058}},{"source":"async/addresses.js","name":"id","original":{"line":108,"column":25},"generated":{"line":1,"column":3060}},{"source":"async/addresses.js","name":"conn","original":{"line":110,"column":10},"generated":{"line":1,"column":3071}},{"source":"async/addresses.js","name":"query","original":{"line":110,"column":15},"generated":{"line":1,"column":3073}},{"source":"async/addresses.js","name":"query","original":{"line":110,"column":15},"generated":{"line":1,"column":3078}},{"source":"async/addresses.js","name":"sql","original":{"line":110,"column":21},"generated":{"line":1,"column":3084}},{"source":"async/addresses.js","name":"changeStatus","original":{"line":113,"column":8},"generated":{"line":1,"column":3087}},{"source":"async/addresses.js","name":"id","original":{"line":113,"column":22},"generated":{"line":1,"column":3106}},{"source":"async/addresses.js","name":"status","original":{"line":113,"column":26},"generated":{"line":1,"column":3108}},{"source":"async/addresses.js","name":"userid","original":{"line":113,"column":34},"generated":{"line":1,"column":3110}},{"source":"async/addresses.js","name":"notes","original":{"line":113,"column":42},"generated":{"line":1,"column":3112}},{"source":"async/addresses.js","original":{"line":114,"column":8},"generated":{"line":1,"column":3115}},{"source":"async/addresses.js","name":"id","original":{"line":114,"column":9},"generated":{"line":1,"column":3119}},{"source":"async/addresses.js","original":{"line":114,"column":13},"generated":{"line":1,"column":3121}},{"source":"async/addresses.js","original":{"line":114,"column":19},"generated":{"line":1,"column":3127}},{"source":"async/addresses.js","name":"Error","original":{"line":114,"column":23},"generated":{"line":1,"column":3131}},{"source":"async/addresses.js","original":{"line":114,"column":29},"generated":{"line":1,"column":3137}},{"source":"async/addresses.js","original":{"line":115,"column":8},"generated":{"line":1,"column":3155}},{"source":"async/addresses.js","name":"status","original":{"line":115,"column":9},"generated":{"line":1,"column":3159}},{"source":"async/addresses.js","original":{"line":115,"column":17},"generated":{"line":1,"column":3161}},{"source":"async/addresses.js","original":{"line":115,"column":23},"generated":{"line":1,"column":3167}},{"source":"async/addresses.js","name":"Error","original":{"line":115,"column":27},"generated":{"line":1,"column":3171}},{"source":"async/addresses.js","original":{"line":115,"column":33},"generated":{"line":1,"column":3177}},{"source":"async/addresses.js","original":{"line":116,"column":8},"generated":{"line":1,"column":3199}},{"source":"async/addresses.js","name":"userid","original":{"line":116,"column":9},"generated":{"line":1,"column":3203}},{"source":"async/addresses.js","original":{"line":116,"column":17},"generated":{"line":1,"column":3205}},{"source":"async/addresses.js","original":{"line":116,"column":23},"generated":{"line":1,"column":3211}},{"source":"async/addresses.js","name":"Error","original":{"line":116,"column":27},"generated":{"line":1,"column":3215}},{"source":"async/addresses.js","original":{"line":116,"column":33},"generated":{"line":1,"column":3221}},{"source":"async/addresses.js","name":"sql","original":{"line":118,"column":10},"generated":{"line":1,"column":3243}},{"source":"async/addresses.js","name":"sql","original":{"line":118,"column":10},"generated":{"line":1,"column":3249}},{"source":"async/addresses.js","name":"status","original":{"line":119,"column":18},"generated":{"line":1,"column":3293}},{"source":"async/addresses.js","name":"userid","original":{"line":119,"column":44},"generated":{"line":1,"column":3314}},{"source":"async/addresses.js","name":"notes","original":{"line":119,"column":55},"generated":{"line":1,"column":3319}},{"source":"async/addresses.js","name":"notes","original":{"line":119,"column":77},"generated":{"line":1,"column":3335}},{"source":"async/addresses.js","original":{"line":119,"column":88},"generated":{"line":1,"column":3340}},{"source":"async/addresses.js","name":"id","original":{"line":120,"column":17},"generated":{"line":1,"column":3362}},{"source":"async/addresses.js","name":"conn","original":{"line":122,"column":10},"generated":{"line":1,"column":3372}},{"source":"async/addresses.js","name":"query","original":{"line":122,"column":15},"generated":{"line":1,"column":3374}},{"source":"async/addresses.js","name":"query","original":{"line":122,"column":15},"generated":{"line":1,"column":3379}},{"source":"async/addresses.js","name":"sql","original":{"line":122,"column":21},"generated":{"line":1,"column":3385}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":3389}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":3393}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":3395}},{"source":"async/addresses.js","name":"AddressAsync","original":{"line":127,"column":19},"generated":{"line":1,"column":3399}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":3401}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":3409}},{"source":"async/addresses.js","original":{"line":127,"column":15},"generated":{"line":1,"column":3417}}],"sources":{"async/addresses.js":"import { toArray, get } from 'lodash';\nimport { conn } from '../server';\n\nclass AddressAsync {\n  constructor() {\n    this.aliases = `\n      congregationid as congregationId,\n      create_user as create_username,\n      update_user as update_username\n    `;\n  }\n\n  async getAddress (id, status = 'Active') {\n    const statusCondition = status === '*' ? '' : ` AND status='${status}'`;\n    const sql = `SELECT *, ${this.aliases} FROM addresses WHERE id=${id}${statusCondition}`;\n    return (await conn.query(sql))[0];\n  }\n\n  async getAddressesByTerritory (terrId, status = 'Active') {\n    const statusCondition = \n      status === '*' ? '' :\n      status === '!Active' ? ` AND NOT status = 'Active'` :\n      ` AND status = '${status}'`;\n\n    const sql = `SELECT *, ${this.aliases} FROM addresses WHERE territory_id=${terrId}${statusCondition}`;\n\n    return toArray(await conn.query(sql));\n  }\n\n  async searchAddresses (congId, keyword, status = 'Active') {\n    const statusCondition = status === '*' ? '' :\n      status === '!Active' ? ` AND NOT status = 'Active'` :\n      ` AND status = '${status}'`;\n\n    const sql = `SELECT *, ${this.aliases} FROM addresses \n    WHERE congregationid=${congId}${statusCondition} AND (addr1 LIKE '%${keyword}%' OR addr2 LIKE '%${keyword}%')`;\n    return toArray(await conn.query(sql));\n  }\n\n  async getDNC (congId) {\n    const sql = `SELECT *, ${this.aliases} FROM addresses WHERE congregationid=${congId} AND status='DNC'`;\n    return toArray(await conn.query(sql));\n  }\n\n  async create (address) {\n    if (!address.congregationId) {\n      throw new Error('congregation id is required');\n    }\n\n    const results = await conn.query(`INSERT INTO addresses (\n      congregationid,\n      territory_id,\n      status,\n      sort,\n      addr1,\n      addr2,\n      city,\n      state_province,\n      postal_code,\n      phone,\n      longitude,\n      latitude,\n      notes,\n      create_user,\n      create_date\n    ) VALUES (\n      ${ get(address, 'congregationId', '') },\n      ${ get(address, 'territory_id', '') },\n      '${ get(address, 'status', 'Active') }',\n      ${ get(address, 'sort', '') },\n      '${ get(address, 'addr1', '') }',\n      '${ get(address, 'addr2', '') }',\n      '${ get(address, 'city', '') }',\n      '${ get(address, 'state_province', '') }',\n      '${ get(address, 'postal_code', '') }',\n      '${ get(address, 'phone', '') }',\n      ${ get(address, 'longitude', 'NULL') },\n      ${ get(address, 'latitude', 'NULL') },\n      '${ get(address, 'notes', '') }',\n      ${ get(address, 'create_user', '') },\n      NOW()\n    )`);\n\n    return results.insertId;\n  }\n\n  async update (address) {\n    if (!(address && address.id)) {\n      throw new Error('Address id is required');\n    }\n\n    const sql = `UPDATE addresses SET\n      ${ address.congregationId ? `congregationid = ${address.congregationId},` : '' }\n      ${ address.territory_id ? `territory_id = ${address.territory_id},` : '' }\n      ${ address.status ? `status = '${address.status}',` : '' }\n      ${ address.sort ? `sort = ${address.sort},` : '' }\n      ${ address.addr1 ? `addr1 = '${address.addr1}',` : '' }\n      ${ address.addr2 ? `addr2 = '${address.addr2}',` : '' }\n      ${ address.city ? `city = '${address.city}',` : '' }\n      ${ address.state_province ? `state_province = '${address.state_province}',` : '' }\n      ${ address.postal_code ? `postal_code = '${address.postal_code}',` : '' }\n      ${ address.phone ? `phone = '${address.phone}',` : '' }\n      ${ address.latitude ? `latitude = ${address.latitude},` : '' }\n      ${ address.longitude ? `longitude = ${address.longitude},` : '' }\n      ${ address.notes ? `notes = '${address.notes}',` : '' }\n      ${ address.update_user ? `update_user = ${address.update_user},` : '' }\n      update_date = NOW()\n    WHERE id = ${address.id}`;\n\n    await conn.query(sql);\n  }\n\n  async changeStatus (id, status, userid, notes) {\n    if (!id) throw new Error('id is required');\n    if (!status) throw new Error('status is required');\n    if (!userid) throw new Error('userid is required');\n\n    const sql = `UPDATE addresses SET \n      status = '${status}', update_user = ${userid} ${ notes ? `, notes = '${notes}'` : '' }\n      WHERE id=${id}`;\n\n    await conn.query(sql);\n  }\n}\n\n\nexport default new AddressAsync();\n"},"lineCount":null}},"error":null,"hash":"115fefba723fdc5df10cdc7c7df21c25","cacheData":{"env":{}}}